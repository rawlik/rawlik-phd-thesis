\chapter{Mapping}
\label{ch:mapping}
An active magnetic shield relies on its coils to counteract field variations.
A disturbance can only be compensated so well, as it can be approximated with the shield's coils.
Therefore, an active shield will perform better if adapted to the magnetic environment, especially if the disturbances are higher-order.

As part of the design process for an active shield for the n2EDM experiment a characterisation of the magnetic fields on the future site was performed.
For this, a magnetic field mapper was built in a form of a tower equipped with magnetic field sensors.

First, a small-scale prototype of the mapper was tested during a mapping campaign at LPSC, Grenoble, France.
It was then extended to full-scale and used for measurements on the site of the n2EDM experiment.




\section{The idea}
An essential input to the design of the n2EDM active magnetic shield was the scope of fields that would need to be compensated.
There are strong magnetic sources in the vicinity of the site, some of them ramping on a daily basis.
Taking a number of maps of the magnetic field was planned to characterise the magnetic environment.

Speed was valued more than precision.
The less time it takes to map the field in the whole area, the less the map would be influenced by the varying external conditions.
Also, the variety of the magnetic environment favoured taking multiple maps under different conditions, rather than fewer precise ones.
The implemented solution was a mobile tower equipped with magnetic field sensors at different heights.
The position and orientation of the tower could be measured while it was moved.

\begin{figure}
  \centering
  \includegraphics[width=\linewidth]{gfx/mapping/lpsc/setup_crop.jpg}
  \caption{The small-scale prototype of the magnetic field mapper.
  The mobile tower houses ten fluxgate magnetometers.
  A bundle of readout cables is visible at the bottom of the tower.
  Behind it a rigid L-piece is visible, which holds three string potentiometers.
  A wire is extended from each potentiometer to the tower.}\label{fig:mapping_bastille_setup}
\end{figure}

% present tense - describing a picture
\marginpar{For maximal linearity, string potentiometers are constructed in a way that the wire is wound flat in one layer only.}
A small-scale prototype setup is pictured in Fig.\,\ref{fig:mapping_bastille_setup}.
The tower
% is \SI{250}{\centi\metre} high and
houses ten fluxgate magnetometers.
In the corner behind the tower a rigid L-piece is visible;
\marginpar{Other names for string potentiometers include: cable-extension transducer, draw-wire sensor and string pot.}
it carries three string potentiometers.
The potentiometers are attached to the tower via a thin wire. The thin wires are wound onto a spring-loaded spool, connected to a rotary potentiometer, on the inside of the potentiometer unit.
The potentiometer gives an analogue signal proportional to the extension of the wire.
The combined information from the three sensors was used to determine the position and orientation of the tower.




\section{The principle of a string-potentiometer--based mapper}
For a known length of wire, if one end is fixed, the other end draws a circle.
The measurement of the position and orientation of the tower is solved by finding the intersections of those circles.
In general, the problem of determining the location based on the measurement of the distance to a set of fixed points is called \emph{trilateration}.
\marginpar{Other position determination methods include triangulation (measurement of angles between lines connecting a set of fixed points) and multilateration (measurement of the difference in distances between a set of fixed points).}

\begin{figure}
  \centering
  \includegraphics[width=0.7\linewidth]{gfx/mapping/geometry.pdf}
  \caption{The geometry of the mapper's position and orientation determination.
  In the orange coordinate system, that of the ``L-piece'', the position of the centre of the tower is $(x,y)$.
  The positions of the string-potentiometers used to determine the tower's position are $(0, y_0)$ and $(x_0, 0)$, and the extensions of their wires $r$ and $\rho$.
  Another coordinate system is depicted (purple), in which the position of one of the string-potentiometers is $(0,0)$ and the other $(d, 0)$.
  The position of the tower in this coordinate system is $(\xi, \nu)$.
  There is also a third string-potentiometer attached to the tower on an arm of a length $a$; its wire length is denoted by $\delta$.}\label{fig:mapping_geometry}
\end{figure}

The geometry is illustrated in Fig.\,\ref{fig:mapping_geometry}.
The two string potentiometers used to determine the position are located at points $(x, y) = (0, y_0)$ and $(x_0, 0)$ (in the L-piece coordinate system, orange in the figure).
The length of wire from these locations, $r$ and $\rho$, are connected to a single point which lies directly on the vertical beam holding the sensors.
We will refer to this point as the centre, even though it is not necessarily the geometric centre of the tower.
The centre lies on the intersection of the corresponding circles.
For the sake of simplicity, we first give the solution for the centre position in the coordinate system depicted in green,
% \note{maybe use the A B and C names here already}
where the first string potentiometer is at $(0,0)$ and the second $(d, 0)$, where
\begin{equation}
  d = \sqrt{x_0^2 + y_0^2}
\end{equation}
with the tower's centre at $(\xi, \nu)$,
\begin{align}
  \xi & = \frac{1}{2d} \left( d^2 - \rho^2 + r^2 \right) \\
  \nu & = \pm\ \frac{1}{2d} \sqrt{ (-d + \rho - r) (-d - \rho + r) (-d + \rho + r) (d + \rho + r) } \ .
\end{align}
There are two solutions, symmetric around the connecting line between the centres of the circles.
It is assumed that the tower never crosses this line.
The transformation of the solution to the ``L-piece'' coordinate system (orange) is
\begin{equation}
  \begin{pmatrix}
    x \\
    y
  \end{pmatrix}
  =
  \begin{pmatrix}
    \cos \alpha & -\sin \alpha \\
    \sin \alpha & \cos \alpha
  \end{pmatrix}
  \begin{pmatrix}
    \xi \\
    \nu
  \end{pmatrix}
  +
  \begin{pmatrix}
    0 \\
    y_0
  \end{pmatrix} \ ,
\end{equation}
where
\begin{equation}
  \alpha = \mathrm{arctan}\, \frac{y_0}{x_0} \ .
\end{equation}
The orientation is determined with a use of the third potentiometer, with its string attached to the tower at a distance $a$ from the centre.
Then, the position of the attachment point lies on the intersection of the circle centred at $(x,y)$ with radius $a$, and one centred at the potentiometer, radius equal to the measured extension of the wire $\delta$.
In this case there are also two solutions, but ambiguity can be avoided by keeping the tower's orientation approximately parallel to the $x$-axis.

In the prototype $x_0 = 0$.
This had the consequence that the precision of determining $x$ was poor when both $y$ was large and $x$ was small,
meaning the two circles intersected at a very small angle.
Due to measurement noise and uncertainty in calibration (the relationship between the analogue signal and the extension of the wires), sometimes the circles did not intersect at all.
In these cases, the middle point of the shortest line connecting the circles is taken as the solution.




\section{LPSC campaign}
\label{sec:lpsc_campaign}
The small-scale prototype setup was used to obtain a magnetic field map of two rooms at the Laboratoire de Physique Subatomique \& Cosmologie (LPSC) in Grenoble, France.
The campaign took place during the days 6.-10.03.2017, with much appreciated help from RÃ©mi Faure, Guillaume Pignol and Dominique Rebreyend.
The rooms, referred to as \emph{Bastille} and \emph{Chalet}, were considered to host a magnetic-field-sensitive setup for ${}^{199}$Hg magnetometry.
Of particular interest were the gradients, which cause an increase in the depolarisation rate of the mercury atoms~\cite{FertlThesis}.
\note{In that case the gradients should be below roughly \SI[per-mode=symbol]{10}{\nano\tesla\per\centi\metre}, but I don't know why.
Ask someone?}

\marginpar{The string potentiometers were equipped with custom made attachments that allowed the wire to protrude at an angle out of the device.
The point where the wires bent was taken to be the middle of the circle in the geometry solution.}
A photograph of the mapping setup is shown in Fig.\,\ref{fig:mapping_bastille_setup}.
The \SI{2.5}{\metre} high mobile tower was equipped with ten three-axis fluxgate magnetic field sensors (Stefan-Mayer FLC3--70, the same as used in the active magnetic field stabilisation system).
The stationary ``L-piece'' held three string potentiometers (Micro-Eplison WDS-15000-P115-SA-P with a \SI{15}{\metre} extension range).
The geometry parameters, as defined in Fig.\,\ref{fig:mapping_geometry}, were: $x_0 = 0$, $y_0 = \SI{1871}{\milli\metre}$, $x_1 = \SI{1756}{\milli\metre}$ and $a = \SI{623}{\milli\metre}$.
The string potentiometer for the orientation measurement was at the point $(\SI{1756}{\milli\metre}, \SI{0}{\milli\metre})$.

% Two of the strings were attached to a point where the vertical beam with the fluxgates is, the third (left on the picture) was attached to the black, short vertical profile on the tower.

% \marginpar{Technical details of the setup: fluxgates: Stefan-Mayer FLC3--70, ADC: aoethu, string potentiometers: Micro-Eplison WDS-15000-P115-SA-P, readout frequency: xxx}

\begin{figure}
  \centering
  \includegraphics[width=\linewidth]{gfx/mapping/lpsc/daq.jpeg}
  \caption{The DAQ system used for the mapping campaign at LPSC\@: a power supply for constant voltage at the potentiometers (grey, lower corner); a custom-built crate for the fluxgates supplying them with power and conditioning the incoming signals (underneath the keyboard and the screen); a National Instruments PXI crate, which simultaneously digitises the analogue voltage signals from the fluxgates and the string pots (not visible, behind the screen); and a PC computer with peripherals.}\label{fig:mapping_bastille_daq}
\end{figure}

The data acquisition system, pictured in Fig.\,\ref{fig:mapping_bastille_daq}, consisted of: a power supply to supply a constant voltage (\SI{10}{\volt}) to the potentiometers; a custom-built crate for the fluxgates, which supplies power and conditions the incoming signals; and a National Instruments PXI crate, which simultaneously digitises the analogue voltage signals from the fluxgates and the string pots.
The data were collected on a PC computer.

\begin{figure}
  \centering
  \includegraphics[width=\linewidth]{gfx/mapping/lpsc/bastille_panorama.jpeg}
  \caption{A panoramic view of the \emph{Bastille} room.
  To the left the ``L-piece'' and the mapping tower are visible.
  In the back is the DAQ system and to the right a door with a long handle, which is visible on the magnetic field maps.}\label{fig:mapping_bastille_panorama}
\end{figure}

A panoramic shot of the Bastille room is presented in Fig.\,\ref{fig:mapping_bastille_panorama}.
The L-piece is visible in the upper-left corner.
To the right is the entrance door.
% In the middle, high on the wall, a power outlet box is visible.
% Behind the wall with the power outlet box there is a pump, which has been at some point removed.
The room is made out of wood and is located  inside a hall made of steel beams and sheets.
% The room's wall with the power outlet on it was located close, less than 1 metre, to a steel wall of the hall.
The hall is equipped a gantry crane, several metres above the roof of the room.
% Directly on the roof there were air conditioning devices, standing about a metre above the roof on steel legs.
% The legs had rather large feet, possibly with a steel plate inside.


\begin{figure}
  \centering
  \includegraphics[width=0.5\linewidth]{gfx/mapping/lpsc/bastille_crane_away_rep_track_crop.pdf}
  \caption{A map of one trace of the tower's centre.
  The outline of the room borders the plot.
  In the upper-right corner the location of the entrance door is marked.
  The ``L-piece'' was in the lower-left corner.}\label{fig:mapping_bastille_track}
\end{figure}

To collect a map the tower was moved around the room by one person with a second taking care that the readout cables did not get in the way of the tower.
\marginpar{The position of the mapper was determined on-line.
On the screen it was displayed where the tower had already been.}
Care was taken to systematically scan the whole room.
% and to maintain approximately the same orientation of the tower throughout the measurement.
A track of one of the collected maps is depicted in Fig.\,\ref{fig:mapping_bastille_track}.
Note that the centre of the tower could only reach a certain distance from the walls, because of the size of the tower's cart.
%\note{maybe mention, that the position was calculated on-line, too}
% Part of the data analysis is performed on-line.
% In particular the voltage readout of the string pots is translated into their lengths which are used to determine the position and orientation of the tower.
% This is to provide feedback during the measurements, necessary to make sure that the whole room was scanned.
The data, the position and orientation of the tower, as well as the magnetic field measurements, were down-sampled and registered at a \SI{50}{\hertz} rate.

\begin{figure}
  \centering
  \includegraphics[width=\linewidth]{gfx/mapping/lpsc/bastille_crane_away_rep_magnitude_low_range_crop.pdf}
  \caption{The map of the magnitude of the magnetic field.
  Each tile depicts a horizontal plane, the field measured by one magnetic sensor.
  For each point, registered at \SI{50}{\hertz} rate, the magnitude is plotted. The colour in between the measurement points is linearly interpolated.
  On the ceiling there are small, strong sources of magnetic fields and the colour scale is saturated.}\label{fig:mapping_bastille_magnitude}
\end{figure}




\section{Data treatment}
\label{sec:mapping_lpsc_data_treatment}
A map of the magnetic field is plotted in Fig.\,\ref{fig:mapping_bastille_magnitude}.
Horizontal slices (each a different sensor) of the magnetic field magnitude are shown, with the height of the slice above the floor indicated.
Towards the roof a number of localised sources are visible;
They can be attributed to air-conditioning system elements mounted on the roof of the hut.

\begin{figure}
  \centering
  \includegraphics[width=\linewidth]{gfx/mapping/lpsc/bastille_crane_away_rep_gradient_205cm_crop.pdf}
  \caption{A map of magnetic gradients in the Bastille room \SI{205}{\centi\metre} above the floor.
  Only the horizontal gradients (with respect to $x$ and $y$) have been estimated.
  Estimating the gradients with respect to $z$ would require comparing measurements between different sensors, whose intrinsic offset would dominate the result.}\label{fig:mapping_bastille_gradient}
\end{figure}

The measured information was also used to estimate the magnetic field gradients.
For this, the mapped area was divided into a $14 \times 14$ grid.
In each bin the measurements were averaged.
Then, the differences between the magnetic field components in the neighbouring pixels were taken, which, when divided by the separation between the bins, give the estimates of the gradient.
% For example, the $\partial B_x / \partial x$ gradient was estimated by the difference between 
The map of the gradient \SI{205}{\centi\metre} above the floor is shown in Fig.\,\ref{fig:mapping_bastille_gradient}.
% Comment on the structures from the roof? On the left side, next to the power outlet box, large gradients above \SI[per-mode=symbol]{20}{\pico\tesla\per\centi\meter} are visible.
Only ``horizontal'' gradients were estimated, ones with respect to $x$ and $y$.
To estimate the vertical ones, with respect to $z$, would require comparing the measurements of different sensors.
The sensors were specified to be only $\pm 1\% \pm \SI{0.5}{\micro\tesla}$ accurate, which in a roughly \SI{50}{\micro\tesla} field adds up to a microtelsa.
With \SI{22}{\centi\meter} separation between the sensors, the systematic effect on the gradient would be \SI[per-mode=symbol]{45}{\nano\tesla\per\centi\meter}.
In the map, gradients lower than \SI[per-mode=symbol]{10}{\nano\tesla\per\centi\meter} are resolved.

\begin{figure}
  \centering
  \includegraphics[width=0.49\linewidth]{gfx/mapping/lpsc/reproducibility_field.pdf}
  \includegraphics[width=0.49\linewidth]{gfx/mapping/lpsc/reproducibility_gradient.pdf}
  \caption{\emph{Left:} Reproducibility of the field, a histogram of the difference in the measured field;
  One entry is a difference along either $x$, $y$ or $z$.
  The width of the distribution is \SI{138}{\nano\tesla}.
  \emph{Right:} reproducibility of the gradient estimation;
  One entry is a horizontal gradient estimate, with respect to $x$ or $y$.
  The width of the distribution is \SI[per-mode=symbol]{3.8}{\nano\tesla\per\centi\metre}.}\label{fig:mapping_bastille_reproducibility}
\end{figure}

Binned data allowed also for a direct comparison between maps.
In order to estimate the reproducibility of the mapping process, two maps were measured directly one after another.
The maps were then subtracted, after binning.
A histogram of the differences is shown in Fig.\,\ref{fig:mapping_bastille_reproducibility}.
The standard deviation of the distribution, a measure of the reproducibility, is \SI{138}{\nano\tesla}.
The reproducibility of the gradient was estimated in the same way, yielding a standard deviation of \SI[per-mode=symbol]{3.8}{\nano\tesla\per\centi\metre}.
This is better than a na\"{\i}ve estimate, which assumes that the value of the field component measured in a single,
$\approx \SI{25}{\centi\metre}$ large bin has an uncorrelated error bar of \SI{138}{\nano\tesla}, resulting in a gradient of
\begin{equation}
  \frac{\SI{138}{\nano\tesla} \, \sqrt{2}}{\SI{25}{\centi\meter}} = \SI[per-mode=symbol]{8}{\nano\tesla\per\centi\meter} \ .
\end{equation}
Reproducibility of the attained field values requires stability over long time periods.
For the gradient of the field to be reproducible, the system only needs to be stable from one bin to the next.

\begin{figure}
  \centering
  \includegraphics[width=\linewidth]{gfx/mapping/lpsc/bastille_crane_change_magnitude_crop.pdf}
  \caption{A map of the magnetic field of a gantry crane in the hall where the Bastille room is located.
  The magnitude of the field difference between two maps is plotted: one with the crane directly above the hut, and one with it moved far away.}\label{fig:mapping_bastille_crane_change}
\end{figure}

Also, two maps taken under different conditions can be compared.
Near the roof of the hall where the Bastille hut is located there is a large gantry crane.
In order to estimate the change in magnetic field when the crane moved two maps were taken: one with the crane in the far end of the hall and another with the crane directly above the hut.
The maps were binned.
Their difference is plotted in Fig.\,\ref{fig:mapping_bastille_crane_change}.
The magnetic field produced by the crane in the room is around \SI{1}{\micro\tesla} strong half a metre above the room's floor, furthest from the crane, and rises to \SI{3}{\micro\tesla} at the roof.

The campaign at LPSC first of all resulted in a detailed magnetic characterisation of the Bastille and Chalet rooms, under consideration for future magnetometry laboratories.
(The maps of the Chalet rooms can be found in App.\,\ref{ch:chalet_appendix}.)
Secondly, the campaign demonstrated the capabilities of the magnetic field mapping with a mobile tower, whose position and orientation is determined with string potentiometers.
The prototype was later enlarged in preparation for the mapping of a much larger volume, one where the n2EDM experiment was to be built.




\section{PSI Area South campaign}
The mapping of Area South in the UCN hall at PSI, the location of the nEDM and n2EDM experiments, took place between 19.12.2017--12.01.2018.
In that time the area was empty; the nEDM apparatus had already been disassembled and a reinforced concrete foundation for the n2EDM experiment had been laid.
The goal of the mapping campaign was to characterise the magnetic field environment, in particular the different fields created by nearby magnets.
The maps will provide the information necessary to design an active system that would efficiently compensate for external fields.
The mapping campaign was a joint venture with Solange Emmenegger and Jochen Krempel.

\begin{figure}
  \centering
  \includegraphics[width=\linewidth]{gfx/mapping/PSI_mapping_photos/image_nedm-constructioncam2_2018-01-12_13-04-00.jpg}
  \caption{Area South in the UCN hall at PSI---The location of the nEDM and n2EDM experiments at PSI\@.
  The brown square outlines the foundation for the n2EDM apparatus, covered with plywood. The mapping tower is being pushed around by one person; another holds the cables. The L-piece with the string potentiometers is visible in the far end of the hall.
  }\label{fig:mapping_photo}
\end{figure}

\marginpar{The total weight of the n2EDM shield is 47 tonnes.}
The prototype mapper used in the LPSC campaign was extended to its full height.
Area South, pictured in Fig.\,\ref{fig:mapping_photo}, is about $10 \times \SI{12}{\metre}$.
The $5.2 \times 5.2 \times \SI{4.8}{\metre}$ magnetic shield of n2EDM would reach almost \SI{7}{\metre} in height.
In the full-scale setup the parameters, as defined in Fig.\,\ref{fig:mapping_geometry}, were:
$x_0 = 0$, $y_0 = \SI{3814}{\milli\metre}$, $x_1 = \SI{3673}{\milli\metre}$ and $a = \SI{965}{\milli\metre}$.
The tower was \SI{8}{\metre} high.
\marginpar{The tower was built out of aluminum trusses, typically used for stages.}
An additional magnetic field sensor directly above the floor was added.
Other than that, no changes from the prototype were made.
The string potentiometers, the magnetic field sensors and the data acquisition system remained the same.

\begin{figure}
  \centering
  \includegraphics[width=\linewidth]{gfx/mapping/Michals_plot.pdf}
  \caption{A map of the magnetic field in the Area South at PSI\@. The field magnitude is plotted in horizontal planes at different heights. The outlines of the n2EDM mu-metal shield and concrete walls are marked.
  Courtesy of Solange Emmenegger~\cite{EmmeneggerThesis}.
  \note{Still to change: cropped at the bottom, shield outline in a different colour, maybe take a map with a denser scanning, which map from the table is that?}}\label{fig:mapping_p-i_map}
\end{figure}

There are three strong magnets close to the area: COMET, SULTAN and COBRA\@.
COMET is a medical cyclotron located several meters into the concrete biological shielding on the far-side wall in Fig.\,\ref{fig:mapping_photo}.
Its around \SIrange[range-phrase=--,range-units=single]{10}{50}{\micro\tesla} field is very inhomogeneous due to the vicinity of the source.
COMET is very rarely turned off.
Fortunately during the mapping campaign there was a scheduled power-cut for which the cyclotron was ramped down.
SULTAN is a superconducting magnet for material research, located $\approx \SI{15}{\metre}$ away from the site.
It ramps daily, creating a $\approx \SI{50}{\micro\tesla}$ field in the area.
COBRA is a magnet located in a neighbouring experimental hall.
The strength of its field is around \SI{5}{\micro\tesla}.

In total 25 maps were taken with various combinations of the states of the magnets.
The maps are summarised in Tab.\,\ref{tab:psi_mapping_maps}.
As of April 2018 the analysis of these maps in ongoing~\cite{EmmeneggerThesis}.
The procedure of binning and subtracting the maps (Sec.\,\ref{sec:mapping_lpsc_data_treatment}) will allow the field of each of the three magnets to be estimated.
The measurements will be an important input to the design of the n2EDM active magnetic shield.
They will help to decide which coils should be built.
It is even possible to design coils dedicated for a particular high-order disturbance, such as COMET\@.

\begin{table}
  \centering
  \begin{tabular}{ccrrr}
    date        &  time   &  SULTAN   &  COBRA  &  COMET \\ \midrule
    19.12.2017  &  17:32  &  100\%    &  100\%  &  100\%  \\
    19.12.2017  &  17:55  &  0\%      &  100\%  &  100\%  \\
    21.12.2017  &  10:04  &  95\%     &  100\%  &  100\%  \\
    21.12.2017  &  10:19  &  ramping  &  100\%  &  100\%  \\
    21.12.2017  &  11:53  &  90\%     &  100\%  &  100\%  \\
    21.12.2017  &  11:56  &  90\%     &  100\%  &  100\%  \\
    21.12.2017  &  13:38  &  20\%     &  100\%  &  100\%  \\
    21.12.2017  &  14:23  &  20\%     &  100\%  &  100\%  \\
    21.12.2017  &  16:36  &  20\%     &  100\%  &  50\%   \\
    21.12.2017  &  16:47  &  ramping  &  100\%  &  50\%   \\
    21.12.2017  &  17:35  &  0\%      &  100\%  &  100\%  \\
    22.12.2017  &  10:55  &  0\%      &  100\%  &  100\%  \\
    04.01.2018  &  15:41  &  0\%      &  0\%    &  100\%  \\
    04.01.2018  &  17:01  &  0\%      &  0\%    &  100\%  \\
    04.01.2018  &  17:17  &  0\%      &  0\%    &  100\%  \\
    05.01.2018  &  14:59  &  0\%      &  0\%    &  0\%    \\
    05.01.2018  &  15:22  &  0\%      &  0\%    &  0\%    \\
    05.01.2018  &  16:12  &  0\%      &  0\%    &  0\%    \\
    05.01.2018  &  16:41  &  0\%      &  0\%    &  0\%    \\
    05.01.2018  &  20:26  &  0\%      &  0\%    &  0\%    \\
    09.01.2018  &  10:55  &  0\%      &  0\%    &  100\%  \\
    09.01.2018  &  11:30  &  0\%      &  0\%    &  100\%  \\
    12.01.2018  &  10:31  &  0\%      &  0\%    &  100\%  \\
    12.01.2018  &  10:55  &  0\%      &  0\%    &  100\%  \\
    12.01.2018  &  14:11  &  0\%      &  0\%    &  100\%  \\
  \end{tabular}
  \caption{List of the maps taken.
  The status of the magnets is given along with an approximate percentage of the maximum field measured during the campaign.}\label{tab:psi_mapping_maps}
\end{table}




\section*{Mapping -- Conclusion}
Active shielding greatly improved the magnetic field stability for the nEDM experiment at PSI\@.
The design of a shield for its successor, n2EDM, proved to be challenging due to tight spatial constraints.

A new method for magnetic field coil design targeted the problem of spatial constraints.
In the design process the coils were constrained to a predefined grid, which was defined to fulfil the constraints.
The resultant coils have a very large fiducial volume, which means they can be fitted tightly around the apparatus.

A prototype grid-based active shield demonstrated magnetic field stabilisation in a large fiducial volume, showing that an active magnetic shield for the n2EDM experiment can be built.

The maps of the magnetic field at the site of n2EDM provides a crucial input to the design of the coils of the new active shield.
The solution can be implemented within the framework of the new coil design method.

The developments from this work lay the foundation for an active magnetic shield for the n2EDM experiment, which would reduce the tens-of-microteslas variations across the volume down to just a few.